<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Painel do Professor ‚Äì PROF-SAFE24 PREMIUM</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- √çCONE DO ATALHO NO CELULAR (PWA / Atalho) -->
    <link rel="icon" href="https://profsafe24.com.br/wp-content/uploads/2025/12/cropped-favicon-profsafe24-32x32.jpg" sizes="32x32" />
    <link rel="icon" href="https://profsafe24.com.br/wp-content/uploads/2025/12/cropped-favicon-profsafe24-192x192.jpg" sizes="192x192" />
    <link rel="apple-touch-icon" href="https://profsafe24.com.br/wp-content/uploads/2025/12/cropped-favicon-profsafe24-180x180.jpg" />
    <meta name="msapplication-TileImage" content="https://profsafe24.com.br/wp-content/uploads/2025/12/cropped-favicon-profsafe24-270x270.jpg" />
    <meta name="theme-color" content="#020617">

    <style>
        body {
            margin: 0;
            font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: radial-gradient(circle at top, #1f2937 0, #020617 50%, #000 100%);
            color: #e5e7eb;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        .shell {
            width: 100%;
            max-width: 480px;
            padding: 18px;
        }

        .card {
            background: rgba(15, 23, 42, 0.96);
            border-radius: 24px;
            border: 1px solid rgba(148, 163, 184, 0.4);
            box-shadow: 0 20px 45px rgba(15, 23, 42, 0.95);
            padding: 18px 18px 16px;
            position: relative;
            overflow: hidden;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .brand-icon {
            width: 40px;
            height: 40px;
            border-radius: 16px;
            background: radial-gradient(circle at 0 0, #facc15, #ea580c);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            color: #020617;
            font-size: 14px;
            box-shadow: 0 0 25px rgba(234, 88, 12, 0.8);
        }

        .brand-title {
            font-size: 18px;
            font-weight: 800;
            letter-spacing: 0.04em;
            background: linear-gradient(120deg, #facc15, #f97316, #facc15);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .brand-sub {
            font-size: 11px;
            color: #9ca3af;
            text-transform: uppercase;
            letter-spacing: 0.16em;
        }

        .clock {
            text-align: right;
            font-size: 14px;
            color: #f97316;
            font-weight: 600;
        }

        .title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .subtitle {
            font-size: 12px;
            color: #9ca3af;
            margin-bottom: 14px;
        }

        /* Bot√£o SOS */
        .panic-zone {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 16px;
        }

        .panic-ring {
            width: 210px;
            height: 210px;
            border-radius: 999px;
            background: radial-gradient(circle at 30% 0, rgba(248, 113, 113, 0.35), transparent 60%);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .panic-button {
            width: 170px;
            height: 170px;
            border-radius: 999px;
            border: none;
            cursor: pointer;
            background: radial-gradient(circle at 30% 0, #ef4444, #b91c1c);
            box-shadow:
                0 0 40px rgba(248, 113, 113, 0.85),
                0 18px 40px rgba(15, 23, 42, 0.95);
            color: #fee2e2;
            font-size: 18px;
            font-weight: 900;
            letter-spacing: 0.15em;
            text-align: center;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.7);
        }

        .panic-button span.small {
            display: block;
            font-size: 11px;
            letter-spacing: 0.08em;
            margin-top: 4px;
        }

        .panic-caption {
            font-size: 11px;
            color: #e5e7eb;
            margin-top: 8px;
            text-align: center;
        }

        /* Form + problemas r√°pidos */
        .section {
            background: rgba(15, 23, 42, 0.98);
            border-radius: 16px;
            border: 1px solid rgba(30, 64, 175, 0.7);
            padding: 12px 12px 10px;
            margin-bottom: 10px;
        }

        .section-title {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .label {
            font-size: 11px;
            color: #9ca3af;
            margin-bottom: 3px;
            display: block;
        }

        input, textarea {
            width: 100%;
            border-radius: 10px;
            border: 1px solid rgba(55, 65, 81, 0.9);
            background: #020617;
            color: #e5e7eb;
            font-size: 12px;
            padding: 8px 10px;
            margin-bottom: 8px;
            box-sizing: border-box;
        }

        input::placeholder,
        textarea::placeholder {
            color: #6b7280;
        }

        textarea {
            resize: vertical;
            min-height: 48px;
            max-height: 110px;
        }

        .quick-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 6px;
        }

        .btn-quick {
            flex: 1 1 48%;
            border-radius: 999px;
            border: 1px solid rgba(55, 65, 81, 0.9);
            background: #020617;
            font-size: 11px;
            color: #e5e7eb;
            padding: 7px 8px;
            cursor: pointer;
            text-align: center;
            user-select: none;
        }

        .btn-quick:hover {
            border-color: #f97316;
        }

        /* ‚úÖ Estado "fixo" (selecionado) */
        .btn-quick.active {
            border-color: #f97316;
            background: #111827;
            box-shadow: 0 0 0 2px rgba(249, 115, 22, 0.15) inset;
        }

        .btn-row {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 6px;
        }

        .btn {
            flex: 1;
            min-width: 120px;
            border-radius: 999px;
            border: none;
            padding: 9px 10px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .btn-main {
            background: linear-gradient(135deg, #fb923c, #ea580c);
            color: #111827;
        }

        .btn-blue {
            background: #1e3a8a;
            color: #e5e7eb;
        }

        .btn-red {
            background: #b91c1c;
            color: #fee2e2;
        }

        #status {
            margin-top: 8px;
            font-size: 11px;
            padding: 8px 9px;
            border-radius: 10px;
            background: #020617;
            border: 1px solid rgba(30, 64, 175, 0.7);
            color: #38bdf8;
        }

        @media (max-width: 480px) {
            .card { padding: 16px 14px 14px; }
            .panic-ring { width: 190px; height: 190px; }
            .panic-button { width: 150px; height: 150px; font-size: 16px; }
        }
    </style>
</head>
<body>
<div class="shell">
    <div class="card">
        <div class="header">
            <div class="brand">
                <div class="brand-icon">SN</div>
                <div>
                    <div class="brand-title">PROF-SAFE24 PREMIUM</div>
                    <div class="brand-sub">PAINEL DO PROFESSOR</div>
                </div>
            </div>
            <div class="clock" id="clockProf"></div>
        </div>

        <div class="title">Bot√£o de P√¢nico do Professor</div>
        <div class="subtitle">
            Use o bot√£o <b>SOS</b> ou selecione um ou mais problemas. A Central ser√° acionada em tempo real.
        </div>

        <!-- Bot√£o SOS -->
        <div class="panic-zone">
            <div class="panic-ring">
                <button class="panic-button" type="button" onclick="enviarSOS()">
                    SOS
                    <span class="small">TOQUE APENAS EM EMERG√äNCIA</span>
                </button>
            </div>
            <div class="panic-caption">
                üî¥ O bot√£o SOS envia um alerta imediato com prioridade m√°xima para a Central.
            </div>
        </div>

        <!-- Identifica√ß√£o + problemas r√°pidos -->
        <div class="section">
            <div class="section-title">Identifica√ß√£o e tipo de ocorr√™ncia</div>

            <label class="label" for="teacher">Nome do professor(a) (opcional)</label>
            <input id="teacher" placeholder="Ex.: Prof. Ana Paula">

            <label class="label" for="room">Sala / Local</label>
            <input id="room" placeholder="Ex.: 7¬∫ Ano B - Sala 12">

            <span class="label">Ocorr√™ncias r√°pidas (pode selecionar mais de uma):</span>
            <div class="quick-grid">
                <button class="btn-quick" type="button" onclick="toggleProblem(this, 'Aluno passou mal em sala de aula')">ü§í Aluno passou mal</button>
                <button class="btn-quick" type="button" onclick="toggleProblem(this, 'Briga entre alunos em sala ou corredor')">‚ö†Ô∏è Briga na sala/corredor</button>
                <button class="btn-quick" type="button" onclick="toggleProblem(this, 'Poss√≠vel invas√£o ou pessoa estranha na escola')">üö® Invas√£o / pessoa estranha</button>
                <button class="btn-quick" type="button" onclick="toggleProblem(this, 'Agress√£o verbal ou f√≠sica contra professor(a)')">üö´ Agress√£o ao professor</button>
                <button class="btn-quick" type="button" onclick="toggleProblem(this, 'Aluno portando objeto suspeito ou arma branca')">üî™ Objeto suspeito / arma</button>
                <button class="btn-quick" type="button" onclick="toggleProblem(this, 'Tentativa de arrombamento ou dano ao patrim√¥nio')">üõë Tentativa de arrombamento</button>
                <button class="btn-quick" type="button" onclick="toggleProblem(this, 'Risco pr√≥ximo ao port√£o ou sa√≠da de alunos')">üöß Risco no port√£o</button>
                <button class="btn-quick" type="button" onclick="toggleProblem(this, 'Pessoa suspeita rondando o entorno da escola')">üë§ Suspeito no entorno</button>
            </div>

            <label class="label" for="description">Descri√ß√£o (opcional ‚Äî pode complementar)</label>
            <textarea id="description"
                      placeholder="Opcional: complemente detalhes (ex.: aluno desmaiou, local exato, apoio necess√°rio)."></textarea>

            <div class="btn-row">
                <button class="btn btn-main" type="button" onclick="enviarAlertaDetalhado()">üö® Enviar alerta</button>
                <button class="btn btn-blue" type="button" onclick="limparCampos()">üßπ Limpar</button>
                <button class="btn btn-red" type="button" onclick="resetarSistema()">‚ü≥ Reiniciar</button>
                <button class="btn btn-red" type="button" onclick="sair()">‚èª Sair</button>
            </div>

            <div id="status">Pronto para uso.</div>
        </div>
    </div>
</div>

<script>
/* ‚úÖ Ocorr√™ncias selecionadas (fica fixo e envia para a Central) */
let selectedProblems = [];

function atualizarRelogio() {
    const el = document.getElementById('clockProf');
    const now = new Date();
    el.textContent = now.toLocaleTimeString('pt-BR', {hour12: false});
}
setInterval(atualizarRelogio, 1000);
atualizarRelogio();

/* ‚úÖ Marca/desmarca e mant√©m ‚Äúfixo‚Äù visualmente */
function toggleProblem(btn, texto) {
    const idx = selectedProblems.indexOf(texto);

    if (idx === -1) {
        selectedProblems.push(texto);
        btn.classList.add('active');
    } else {
        selectedProblems.splice(idx, 1);
        btn.classList.remove('active');
    }

    // ‚úÖ A descri√ß√£o √© apenas para observa√ß√µes extras.
    // As ocorr√™ncias selecionadas s√£o enviadas no campo problems (sem duplicar texto).
    const statusEl = document.getElementById("status");
    statusEl.textContent = selectedProblems.length
        ? "Ocorr√™ncias selecionadas: " + selectedProblems.join(", ")
        : "Nenhuma ocorr√™ncia selecionada.";
    statusEl.style.color = selectedProblems.length ? "#22c55e" : "#38bdf8";



}

async function enviarSOS() {
    const teacher = document.getElementById('teacher').value.trim();
    const room = document.getElementById('room').value.trim();
    const statusEl = document.getElementById('status');

    statusEl.textContent = "Enviando SOS...";
    statusEl.style.color = "#38bdf8";

    // SOS: envia prioridade m√°xima (n√£o depende das ocorr√™ncias)
    await enviarAlerta({
        teacher: teacher || "Professor(a)",
        room: room || "Local n√£o informado",
        problems: selectedProblems, // ‚úÖ se tiver selecionadas, tamb√©m envia
        description: "SOS r√°pido"
    }, statusEl, "SOS enviado com sucesso! Central acionada.");
}

async function enviarAlertaDetalhado() {
    const teacher = document.getElementById('teacher').value.trim();
    const room = document.getElementById('room').value.trim();
    const desc = document.getElementById('description').value.trim();
    const statusEl = document.getElementById('status');

    // ‚úÖ Regra: precisa ter Sala/Local e (ocorr√™ncia OU descri√ß√£o)
    if (!room || (!desc && selectedProblems.length === 0)) {
        statusEl.textContent = "Preencha Sala/Local e selecione ao menos uma ocorr√™ncia (ou escreva a descri√ß√£o).";
        statusEl.style.color = "#f97316";
        return;
    }

    statusEl.textContent = "Enviando alerta...";
    statusEl.style.color = "#38bdf8";

    await enviarAlerta({
        teacher: teacher || "Professor(a)",
        room: room,
        problems: selectedProblems,       // ‚úÖ ENVIA AS OCORR√äNCIAS
        description: (desc || "") // ‚úÖ fallback
    }, statusEl, "Alerta enviado com sucesso! Central notificada.");
}

async function enviarAlerta(payload, statusEl, mensagemOk) {
    try {
        // Multi-escolas: se o link tiver ?school=..., envia junto sem quebrar uso atual
        const params = new URLSearchParams(window.location.search);
        const school = (params.get('school') || '').trim();
        if (school) payload.school = school;

        const resp = await fetch("/api/alert", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify(payload)
        });

        const data = await resp.json().catch(() => ({}));
        if (resp.ok && data.ok) {
            statusEl.textContent = mensagemOk;
            statusEl.style.color = "#22c55e";
        } else {
            statusEl.textContent = (data && data.error) ? ("Erro: " + data.error) : "Erro ao enviar alerta.";
            statusEl.style.color = "#f97316";
        }
    } catch (e) {
        console.error(e);
        statusEl.textContent = "Falha de comunica√ß√£o com o servidor.";
        statusEl.style.color = "#f97316";
    }
}

function limparCampos() {
    document.getElementById("teacher").value = "";
    document.getElementById("room").value = "";
    document.getElementById("description").value = "";

    // ‚úÖ Limpa ocorr√™ncias selecionadas + visual ‚Äúfixo‚Äù
    selectedProblems = [];
    document.querySelectorAll(".btn-quick.active").forEach(b => b.classList.remove("active"));

    const statusEl = document.getElementById("status");
    statusEl.textContent = "Campos limpos. Sistema pronto.";
    statusEl.style.color = "#38bdf8";
}

async function resetarSistema() {
    // üîí Seguran√ßa: limpeza do sistema agora √© SOMENTE pela Central/Admin.
    const statusEl = document.getElementById("status");
    statusEl.textContent = "A√ß√£o restrita: apenas a Central pode reiniciar/limpar o sistema.";
    statusEl.style.color = "#f97316";
}

function sair(){
  window.location.replace('/professor');
}

// üîí TRAVA DE NAVEGA√á√ÉO: impede voltar para outras telas
(function lockProfessor(){
  history.replaceState(null, '', '/professor');
  window.addEventListener('popstate', function(){
    window.location.replace('/professor');
  });
})();
</script>
</body>
</html>
